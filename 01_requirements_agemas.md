# 要件定義書：地域コミュニティ向けおさがり共有サイト

**プロジェクト名**: あげますサイト  
**バージョン**: 2.0（改訂版）  
**作成日**: 2026年1月11日  
**対象地域**: 長野県北部農村地域（Omi Village及び隣村）

---

## 1. プロジェクト概要

### 1.1 背景・目的

地域内で不要になった物を無料でやり取りするためのコミュニティプラットフォーム。フリマアプリとは異なり、実名制・小規模・信頼ベースの取引を想定。システムの簡潔性と引き継ぎの容易さを最優先。

### 1.2 対象ユーザー

- 初期ユーザー：20-30人の既知ネットワーク
- 拡大後：最大100人（Omi Village及び隣村の地域コミュニティ）
- 年齢層：20-70代（スマートフォン、PCでアクセス可能な者）

### 1.3 提供価値

- 不要な物の活用（廃棄削減、資源循環）
- 地域内の信頼ベースの取引体験
- 地域コミュニティの活性化

---

## 2. ビジネス要件

### 2.1 運用体制

- **運営者**: Katsushi（データアナリスト・コミュニティ代表）
- **ユーザー登録方式**: 運営者による手動登録のみ（招待制）
- **初期運用期間**: 3ヶ月テスト運用
- **コスト目標**: 月額¥200-500（Google Sheets API, Cloud Storage, Firestore）
- **継続性**: 非開発者でも運用・保守可能な設計

### 2.2 個人情報方針

**保持する個人情報**：
- 実名（必須）
- パスワードハッシュ（ハッシュ化済み、bcrypt）

**保持しない情報**：
- メールアドレス
- 電話番号
- 住所

**理由**：個人情報漏洩リスク最小化、GDPR 対応、運営の簡潔性

### 2.3 利用規約・ガイドライン

以下を運営者が策定し、サイト上で公開：

- **禁止事項**：盗難品、危険品、違法品
- **説明と実物のズレへの対応例**
- **連絡が取れない場合の対応**
- **ユーザー停止の基準**
- **個人情報の取り扱い**

### 2.4 トラブル対応方針

- **原則**：当事者間で LINE 等で解決
- **運営者の役割**：
  - ルール違反が明白な場合のユーザー停止
  - トラブル記録の保持と参照（Firestore ログ）
  - 必要に応じた仲裁（情報提供のみ）
- **連絡先交換**: アプリ内メッセージング不要、LINE で対応

---

## 3. 機能要件

### 3.1 ユーザー管理

**FR-1.1: ユーザー登録**
- 運営者のみが登録可能（手動）
- ユーザー情報：実名、パスワード
- Google Sheets『master_users』に記録
- パスワードは bcrypt でハッシュ化

**FR-1.2: ユーザー認証**
- Streamlit ログイン画面で「実名」と「パスワード」を入力
- Firebase Auth または Firestore の認証機能を使用
- セッション管理は Streamlit の session_state で管理

**FR-1.3: ユーザー停止**
- 運営者が Firestore 管理画面でユーザーを停止可能
- 停止ユーザーはログイン不可

### 3.2 投稿機能

**FR-2.1: 投稿作成**
- ログイン必須
- タイトル（必須、100文字以内）
- 説明文（任意、1000文字以内）
- 写真（最大3枚、JPG/PNG、5MB以下）
- カテゴリ選択（衣類、子ども用品、家具、家電、その他）
- 自動タイムスタンプ記録
- 画像は Google Cloud Storage に保存、URL を Firestore に記録

**FR-2.2: 投稿の状態管理**
- ステータス：「募集中」「受け取り決定」「完了」「キャンセル」
- 投稿者のみが状態変更可能

**FR-2.3: 投稿一覧・検索**
- カテゴリ別フィルタリング
- 「募集中」のみ表示オプション
- キーワード検索（タイトル・説明文）
- 新着順での並び替え

**FR-2.4: 投稿の削除**
- 投稿者のみが削除可能（ただしログには記録を残す）

### 3.3 返信（スレッド）機能

**FR-3.1: 返信作成**
- ログイン必須
- 返信テキスト（500文字以内、例「欲しいです」）
- 返信画像（任意、1枚まで）
- 自動タイムスタンプ記録

**FR-3.2: 返信の状態管理**
- ステータス：「提案」「了承」「辞退」
- 投稿者が返信に「了承」すると、その返信者が「受け取り決定」ユーザーになる

**FR-3.3: スレッド表示**
- 投稿と、それに対する全返信を時系列で表示
- ログイン者のみ返信者の実名を表示

**FR-3.4: 返信通知**
- 投稿者が新しい返信を受け取った際、画面に「新着通知」を表示（メール通知不要）

### 3.4 ユーザープロフィール

**FR-4.1: プロフィール表示**
- 実名
- 登録日
- 投稿数、取引数（完了した投稿数）

**FR-4.2: ユーザーの取引履歴**
- そのユーザーが投稿した物の一覧
- そのユーザーが受け取った物の一覧

### 3.5 管理機能

**FR-5.1: ログ検索**
- ユーザーID検索
- 日付範囲検索
- アクション別（投稿、返信、状態変更）での検索

**FR-5.2: トラブル調査**
- 特定ユーザーの全取引履歴を表示
- 該当投稿・返信の全内容を表示

**FR-5.3: ユーザー停止**
- ユーザーの停止/再有効化
- 停止理由の記録

---

## 4. 非機能要件

### 4.1 パフォーマンス

- **レスポンス時間**: 初回読み込み 3秒以内、その後は 1秒以内
- **スケーラビリティ**: 100人規模での同時アクセス 5-10人対応

### 4.2 可用性

- **稼働率**: 99%以上（月間ダウンタイム 43分以下）
- **バックアップ**: Firestore 自動バックアップ、定期的に GCS へ手動バックアップ

### 4.3 セキュリティ

- **認証**: メール/パスワード認証（実名で識別）
- **暗号化**: HTTPS 必須、パスワードは bcrypt でハッシュ化
- **アクセス制御**: ユーザーは自分の投稿・返信のみ編集・削除可能
- **個人情報**: 実名は投稿者として表示、最小限の情報保有

### 4.4 ログ・監査

- **全アクション記録**: 全投稿、返信、状態変更を Firestore に記録
- **ログ保持期間**: 最低 1年間
- **ログアクセス**: 運営者のみ

### 4.5 ユーザビリティ

- **対応デバイス**: スマートフォン（iOS/Android）、PC
- **レスポンシブデザイン**
- **直感的な操作**: 投稿・返信は3ステップ以内

---

## 5. 制約条件

### 5.1 技術的制約

- **予算**: 月額¥200-500 の GCP 費用以内
- **開発時間**: 初期構築 3-4日
- **メンテナンス**: 月 2-3時間
- **継続性**: 非開発者でも基本的な運用が可能

### 5.2 ビジネス上の制約

- **ユーザー招待制**: 初期段階では既知ネットワークのみ
- **実名制**: すべてのユーザーが実名登録
- **無料取引**: 金銭取引なし
- **最大ユーザー数**: 100人未満

### 5.3 法律・規制

- **個人情報保護**: 利用規約で個人情報の取り扱いを明記
- **著作権**: 利用規約で著作権侵害品の投稿禁止を明記

---

## 6. 成功基準

### 6.1 定量的指標（3ヶ月後）

- **ユーザー数**: 30人以上
- **投稿数**: 月 30件以上
- **完了取引数**: 月 15件以上
- **トラブル件数**: 1件以下

### 6.2 定性的指標

- **ユーザー満足度**: アンケートで「満足」以上 80%
- **コミュニティ定着度**: リピートユーザー率 70%以上

---

## 7. 今後の拡張要件（スコープ外）

初期構築後、以下を検討：

- **評価機能**: 取引相手の評価・コメント
- **地図表示**: 投稿場所の地図表示
- **分析ダッシュボード**: BigQuery を使用した取引分析
- **モバイルアプリ**: ネイティブアプリ化

---

## 8. 用語定義

| 用語 | 定義 |
|------|------|
| 投稿 | ユーザーが「あげたい」物について作成した情報 |
| 返信 | 投稿に対して「もらいたい」意思を示したコメント |
| 受け取り決定 | 投稿者が返信者を選定し、取引を確定した状態 |
| ログ | 全ユーザーアクション（投稿・返信・状態変更）の記録 |
| 招待制 | 既存ユーザー or 運営者の招待でのみ登録可能 |
